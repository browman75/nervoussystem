<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç¶“å‚³å°è·¯å¾‘æ’åºæŒ‘æˆ°</title>
    <style>
        :root {
            --primary: #2980b9;
            --accent: #f39c12;
            --bg-color: #f0f3f5;
            --card-bg: #fff;
            --text-color: #2c3e50;
            --success: #27ae60;
            --error: #c0392b;
        }

        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
            user-select: none;
        }

        header {
            background-color: var(--primary);
            color: white;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.5rem; }
        .level-info { font-size: 1rem; margin-top: 5px; opacity: 0.9; }

        /* éŠæˆ²ä¸»å€ */
        .game-container {
            width: 95%;
            max-width: 900px;
            margin: 20px auto;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* é¡Œç›®å€ */
        .question-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-left: 6px solid var(--accent);
        }

        .scenario { font-size: 1.3rem; font-weight: bold; margin-bottom: 10px; }
        .hint { font-size: 0.95rem; color: #7f8c8d; }

        /* ç­”æ¡ˆæ’åºå€ (Sequence) */
        .sequence-area {
            background: #e8eaeb;
            min-height: 120px;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            border: 2px dashed #bdc3c7;
            transition: all 0.3s;
        }

        .sequence-area.correct {
            border-color: var(--success);
            background-color: #eafaf1;
        }

        .sequence-area.wrong {
            border-color: var(--error);
            animation: shake 0.4s;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #dcdcdc;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            color: #34495e;
            transition: transform 0.1s, background 0.2s;
            white-space: nowrap;
        }

        .card:active { transform: scale(0.95); }
        .card:hover { border-color: var(--primary); background: #fdfdfd; }

        /* æµç¨‹ä¸­çš„å¡ç‰‡ */
        .card.in-seq {
            background: var(--primary);
            color: white;
            border: none;
            box-shadow: 0 4px 8px rgba(41, 128, 185, 0.3);
        }
        
        .card.in-seq:hover { background: #c0392b; } /* Hover æç¤ºåˆªé™¤ (ç´…è‰²) */

        .arrow {
            color: #95a5a6;
            font-size: 1.2rem;
            margin: 0 5px;
            font-weight: bold;
        }

        /* é¸é …æ±  (Pool) */
        .options-pool {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.05);
        }

        .pool-title {
            font-size: 1rem;
            color: #7f8c8d;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .pool-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        /* ç¨®é¡æ¨™ç±¤é¡è‰²å€åˆ† */
        .card[data-type="receptor"] { border-bottom: 3px solid #e67e22; }
        .card[data-type="effector"] { border-bottom: 3px solid #27ae60; }
        .card[data-type="cns"] { border-bottom: 3px solid #8e44ad; }
        .card[data-type="neuron"] { border-bottom: 3px solid #2980b9; }

        /* æŒ‰éˆ•å€ */
        .control-area {
            text-align: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .btn:hover { transform: translateY(-2px); background: #1f618d; }
        .btn:disabled { background: #95a5a6; cursor: not-allowed; transform: none; }

        /* å®Œæˆç•«é¢ */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            display: none;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

    </style>
</head>
<body>

    <header>
        <h1>ç¥ç¶“å‚³å°è·¯å¾‘æ’åº</h1>
        <div class="level-info" id="level-display">é¡Œç›® 1 / 4</div>
    </header>

    <div class="game-container">
        <!-- é¡Œç›® -->
        <div class="question-box">
            <div class="scenario" id="q-text">é¡Œç›®è¼‰å…¥ä¸­...</div>
            <div class="hint">è«‹ä¾åºé»æ“Šä¸‹æ–¹å­—å¡ï¼Œæ’åˆ—å‡ºç¥ç¶“å‚³å°çš„è·¯å¾‘ã€‚</div>
        </div>

        <!-- æ’åˆ—å€ -->
        <div class="sequence-area" id="sequence-box">
            <span style="color:#bdc3c7; font-style:italic;">(è«‹é»é¸ä¸‹æ–¹å­—å¡åŠ å…¥...)</span>
        </div>

        <!-- æ§åˆ¶æŒ‰éˆ• -->
        <div class="control-area">
            <button class="btn" id="submit-btn" onclick="checkAnswer()">é€å‡ºç­”æ¡ˆ</button>
        </div>

        <!-- å­—å¡æ±  -->
        <div class="options-pool">
            <div class="pool-title">å¯ç”¨å­—å¡ (é»æ“ŠåŠ å…¥)</div>
            <div class="pool-grid" id="pool-box">
                <!-- å—å™¨ -->
                <div class="card" data-type="receptor" onclick="addToSequence('çœ¼(å—å™¨)')">çœ¼(å—å™¨)</div>
                <div class="card" data-type="receptor" onclick="addToSequence('è€³(å—å™¨)')">è€³(å—å™¨)</div>
                <div class="card" data-type="receptor" onclick="addToSequence('é¼»(å—å™¨)')">é¼»(å—å™¨)</div>
                <div class="card" data-type="receptor" onclick="addToSequence('èˆŒ(å—å™¨)')">èˆŒ(å—å™¨)</div>
                <div class="card" data-type="receptor" onclick="addToSequence('çš®è†š(å—å™¨)')">çš®è†š(å—å™¨)</div>
                
                <!-- ç¥ç¶“å…ƒ -->
                <div class="card" data-type="neuron" onclick="addToSequence('æ„Ÿè¦ºç¥ç¶“å…ƒ')">æ„Ÿè¦ºç¥ç¶“å…ƒ</div>
                <div class="card" data-type="neuron" onclick="addToSequence('é‹å‹•ç¥ç¶“å…ƒ')">é‹å‹•ç¥ç¶“å…ƒ</div>

                <!-- ä¸­æ¨ -->
                <div class="card" data-type="cns" onclick="addToSequence('å¤§è…¦')">å¤§è…¦</div>
                <div class="card" data-type="cns" onclick="addToSequence('å°è…¦')">å°è…¦</div>
                <div class="card" data-type="cns" onclick="addToSequence('è…¦å¹¹')">è…¦å¹¹</div>
                <div class="card" data-type="cns" onclick="addToSequence('è„Šé«“')">è„Šé«“</div>
                
                <!-- å‹•å™¨ -->
                <div class="card" data-type="effector" onclick="addToSequence('è‚Œè‚‰(å‹•å™¨)')">è‚Œè‚‰(å‹•å™¨)</div>
                <div class="card" data-type="effector" onclick="addToSequence('è…ºé«”(å‹•å™¨)')">è…ºé«”(å‹•å™¨)</div>
            </div>
        </div>
    </div>

    <!-- æ­å–œé€šé—œ -->
    <div class="modal" id="finish-modal">
        <h1 style="font-size: 3rem; color: #f1c40f;">æŒ‘æˆ°æˆåŠŸï¼ğŸ‰</h1>
        <p style="font-size: 1.5rem; margin-top: 20px;">ä½ å·²ç¶“å®Œå…¨æŒæ¡ç¥ç¶“å‚³å°è·¯å¾‘äº†ï¼</p>
        <button class="btn" style="margin-top:40px; background:#e67e22;" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
        <a href="unit_summary.html" class="btn" style="margin-top:20px; background:#27ae60; text-decoration:none;">å‰å¾€ç¸½çµé é¢</a>
    </div>

    <script>
        // é¡Œç›®è³‡æ–™ (å…±4é¡Œ)
        const levels = [
            {
                id: 1,
                text: "é¡Œç›® 1ï¼šè…³è¸©åˆ°é‡ï¼Œç«‹åˆ»ç¸®è…³ (åå°„ä½œç”¨)",
                // èªªæ˜ï¼šå››è‚¢åå°„ï¼Œç”±è„Šé«“æ§åˆ¶ï¼Œä¸ç¶“å¤§è…¦ã€‚
                answer: ["çš®è†š(å—å™¨)", "æ„Ÿè¦ºç¥ç¶“å…ƒ", "è„Šé«“", "é‹å‹•ç¥ç¶“å…ƒ", "è‚Œè‚‰(å‹•å™¨)"]
            },
            {
                id: 2,
                text: "é¡Œç›® 2ï¼šè…³è¸©åˆ°é‡ï¼Œè¦ºå¾—å¾ˆç—›ï¼Œæ‰‹æ‘¸è…³ (æ„è­˜è¡Œç‚º)",
                // èªªæ˜ï¼šç—›è¦ºå‚³åˆ°å¤§è…¦ï¼Œæ‰‹éƒ¨å‹•ä½œç”±å¤§è…¦ä¸‹ä»¤ã€‚
                // å®Œæ•´è·¯å¾‘ï¼šçš®è†š -> æ„Ÿè¦º -> è„Šé«“ -> å¤§è…¦ -> è„Šé«“ -> é‹å‹• -> è‚Œè‚‰
                answer: ["çš®è†š(å—å™¨)", "æ„Ÿè¦ºç¥ç¶“å…ƒ", "è„Šé«“", "å¤§è…¦", "è„Šé«“", "é‹å‹•ç¥ç¶“å…ƒ", "è‚Œè‚‰(å‹•å™¨)"]
            },
            {
                id: 3,
                text: "é¡Œç›® 3ï¼šèåˆ°é¦™å‘³ï¼Œä¸è‡ªè¦ºæµå£æ°´ (åå°„ä½œç”¨)",
                // èªªæ˜ï¼šé ­éƒ¨åå°„(å”¾æ¶²åˆ†æ³Œ)ï¼Œä¸­æ¨åœ¨è…¦å¹¹ã€‚
                answer: ["é¼»(å—å™¨)", "æ„Ÿè¦ºç¥ç¶“å…ƒ", "è…¦å¹¹", "é‹å‹•ç¥ç¶“å…ƒ", "è…ºé«”(å‹•å™¨)"]
            },
            {
                id: 4,
                text: "é¡Œç›® 4ï¼šçœ‹åˆ°çƒé£›éä¾†ï¼Œæƒ³çœ¨çœ¼ï¼Œä½†åˆ»æ„ä¸çœ¨çœ¼ (æ„è­˜è¡Œç‚º)",
                // èªªæ˜ï¼šè¦–è¦º(çœ¼) -> å¤§è…¦(åˆ¤æ–·èˆ‡æ§åˆ¶) -> é‹å‹•ç¥ç¶“å…ƒ(æ§åˆ¶çœ¼éƒ¨è‚Œè‚‰) -> è‚Œè‚‰ã€‚
                // ä¿®æ”¹ï¼šä¾æ“šæŒ‡ç¤ºï¼Œç°¡åŒ–è·¯å¾‘ï¼Œä¸ç¶“éè…¦å¹¹ã€‚
                answer: ["çœ¼(å—å™¨)", "æ„Ÿè¦ºç¥ç¶“å…ƒ", "å¤§è…¦", "é‹å‹•ç¥ç¶“å…ƒ", "è‚Œè‚‰(å‹•å™¨)"]
            }
        ];

        let currentLevelIndex = 0;
        let userSequence = []; // å­˜ä½¿ç”¨è€…ç›®å‰çš„æ’åº

        // åˆå§‹åŒ–
        function initGame() {
            loadLevel(0);
        }

        function loadLevel(index) {
            currentLevelIndex = index;
            const level = levels[index];
            
            document.getElementById('level-display').innerText = `é¡Œç›® ${index + 1} / ${levels.length}`;
            document.getElementById('q-text').innerText = level.text;
            
            // æ¸…ç©ºæ’åºå€
            userSequence = [];
            renderSequence();
            
            // é‡ç½®ç‹€æ…‹
            const seqBox = document.getElementById('sequence-box');
            seqBox.className = 'sequence-area';
            document.getElementById('submit-btn').innerText = "é€å‡ºç­”æ¡ˆ";
            document.getElementById('submit-btn').disabled = false;
        }

        // åŠ å…¥å¡ç‰‡åˆ°åºåˆ—
        function addToSequence(text) {
            userSequence.push(text);
            renderSequence();
        }

        // ç§»é™¤æœ€å¾Œä¸€å¼µå¡ç‰‡
        function removeLast() {
            if (userSequence.length > 0) {
                userSequence.pop();
                renderSequence();
            }
        }

        // æ¸²æŸ“åºåˆ—å€
        function renderSequence() {
            const container = document.getElementById('sequence-box');
            container.innerHTML = '';

            if (userSequence.length === 0) {
                container.innerHTML = '<span style="color:#bdc3c7; font-style:italic;">(è«‹é»é¸ä¸‹æ–¹å­—å¡åŠ å…¥...)</span>';
                return;
            }

            userSequence.forEach((item, index) => {
                // ç®­é ­
                if (index > 0) {
                    const arrow = document.createElement('div');
                    arrow.className = 'arrow';
                    arrow.innerText = 'â®•';
                    container.appendChild(arrow);
                }

                // å¡ç‰‡
                const card = document.createElement('div');
                card.className = 'card in-seq';
                card.innerText = item;
                
                // åªæœ‰æœ€å¾Œä¸€å¼µå¯ä»¥é»æ“Šç§»é™¤
                if (index === userSequence.length - 1) {
                    card.onclick = removeLast;
                    card.title = "é»æ“Šç§»é™¤";
                } else {
                    card.style.cursor = "default";
                    card.style.opacity = "0.9";
                }

                container.appendChild(card);
            });
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const currentLevel = levels[currentLevelIndex];
            const correctSeq = currentLevel.answer;
            const seqBox = document.getElementById('sequence-box');
            const btn = document.getElementById('submit-btn');

            // æ¯”å°é•·åº¦èˆ‡å…§å®¹
            let isCorrect = true;
            if (userSequence.length !== correctSeq.length) {
                isCorrect = false;
            } else {
                for (let i = 0; i < correctSeq.length; i++) {
                    if (userSequence[i] !== correctSeq[i]) {
                        isCorrect = false;
                        break;
                    }
                }
            }

            if (isCorrect) {
                // ç­”å°
                seqBox.classList.add('correct');
                btn.innerText = "âœ… æ­£ç¢ºï¼ä¸‹ä¸€é¡Œ...";
                btn.disabled = true;

                setTimeout(() => {
                    if (currentLevelIndex < levels.length - 1) {
                        loadLevel(currentLevelIndex + 1);
                    } else {
                        document.getElementById('finish-modal').style.display = 'flex';
                    }
                }, 1500);

            } else {
                // ç­”éŒ¯
                seqBox.classList.add('wrong');
                btn.innerText = "âŒ é †åºæœ‰èª¤ï¼Œè«‹ä¿®æ­£";
                
                setTimeout(() => {
                    seqBox.classList.remove('wrong');
                    btn.innerText = "é€å‡ºç­”æ¡ˆ";
                }, 1000);
            }
        }

        // å•Ÿå‹•
        initGame();

    </script>
</body>
</html>