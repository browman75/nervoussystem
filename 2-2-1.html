<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç¶“ç§‘é†«å¸«è¨ºæ–·å®¤ (é›™å‘äº’å‹•ç‰ˆ)</title>
    <style>
        * { box-sizing: border-box; }

        :root {
            --primary: #2c3e50;
            --accent: #16a085;
            --bg-color: #f0f2f5;
            --text-color: #2c3e50;
            --btn-bg: #fff;
            --btn-hover: #e8f8f5;
            /* è…¦éƒ¨é¡è‰² */
            --c-cerebrum: #e5989b;
            --c-cerebellum: #ffb703;
            --c-brainstem: #8ecae6;
            --c-spinal: #cdb4db;
            --c-sensory: #a2d2ff;
            --c-motor: #ffafcc;
            --ai-color: #8e44ad;
        }

        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
        }

        header {
            width: 100%;
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.6rem; }
        .subtitle { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }

        /* --- ä¸»ç‰ˆé¢ï¼šä¸‰æ¬„å¼ä½ˆå±€ (ç—…æ­· | åœ–ç‰‡ | æŒ‰éˆ•) --- */
        .game-wrapper {
            display: flex;
            width: 95%;
            max-width: 1200px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
            min-height: 600px;
        }

        /* 1. å·¦å´ï¼šç—…æ­·èˆ‡ AI */
        .info-panel {
            flex: 1.2;
            padding: 25px;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* 2. ä¸­é–“ï¼šè§£å‰–åœ– (å¯äº’å‹•) */
        .diagram-panel {
            flex: 1.5;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            border-right: 1px solid #eee;
            position: relative;
            padding: 10px;
        }

        /* 3. å³å´ï¼šæŒ‰éˆ•æ§åˆ¶å€ */
        .controls-panel {
            flex: 0.8;
            padding: 20px;
            background-color: #f8f9fa;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        /* --- å…ƒä»¶æ¨£å¼ --- */
        .case-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .case-tag {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .ai-badge {
            background: var(--ai-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            display: none;
        }

        .symptom-text {
            font-size: 1.25rem;
            line-height: 1.6;
            font-weight: bold;
            margin-bottom: 20px;
            color: #34495e;
        }

        .instruction {
            background: #ecf0f1;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
        }

        /* æŒ‰éˆ•ç¶²æ ¼ */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }

        .option-btn {
            background: white;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            padding: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 3px 0 #bdc3c7;
        }

        .option-btn:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        .option-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--btn-hover);
        }

        /* ç­”å°/ç­”éŒ¯æ¨£å¼ (æŒ‰éˆ•) */
        .option-btn.correct {
            background: #27ae60;
            color: white;
            border-color: #219150;
            box-shadow: 0 3px 0 #219150;
            pointer-events: none;
        }

        .option-btn.wrong {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
            box-shadow: 0 3px 0 #c0392b;
            animation: shake 0.4s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* SVG æ¨£å¼ */
        svg {
            width: 100%;
            height: auto;
            max-height: 550px;
            touch-action: manipulation; /* å„ªåŒ–è§¸æ§ */
        }
        
        /* æ§‹é€ æ–‡å­—æ¨™ç±¤ */
        .label-text {
            font-size: 24px;
            font-weight: bold;
            fill: #333;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none; /* è®“é»æ“Šç©¿é€æ–‡å­— */
        }
        
        .label-line {
            stroke: #555;
            stroke-width: 2;
            pointer-events: none;
        }

        /* SVG äº’å‹•æ¨£å¼ */
        .brain-part {
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .brain-part:hover {
            opacity: 0.7; /* ç°¡å–®çš„ hover æ•ˆæœ */
        }

        /* SVG é«˜äº®æ¨£å¼ (å¼·åˆ¶è¦†è“‹) */
        .svg-correct {
            stroke: #27ae60 !important;
            stroke-width: 4px !important;
            fill-opacity: 0.8 !important;
        }
        .svg-wrong {
            stroke: #e74c3c !important;
            stroke-width: 4px !important;
        }

        /* å›é¥‹å€ */
        .feedback-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.5s;
        }
        .feedback-box.correct { background: #d5f5e3; color: #145a32; border: 1px solid #27ae60; }
        .feedback-box.wrong { background: #fadbd8; color: #7b241c; border: 1px solid #c0392b; }

        /* åŠŸèƒ½æŒ‰éˆ• */
        .action-btn {
            width: 100%;
            padding: 12px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 15px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .next-btn { background: var(--accent); color: white; display: none; }
        .next-btn:hover { background: #1abc9c; transform: scale(1.02); }

        .ai-btn { 
            background: white; 
            color: var(--ai-color); 
            border: 2px solid var(--ai-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .ai-btn:hover { background: #fdf2ff; }

        .ai-gen-btn { background: var(--ai-color); color: white; display: none; }
        .ai-gen-btn:hover { background: #7d3c98; }

        .hint-display {
            margin-top: 10px;
            padding: 10px;
            background: #fdf2ff;
            border: 1px dashed var(--ai-color);
            color: var(--ai-color);
            border-radius: 6px;
            font-size: 0.9rem;
            display: none;
        }

        .progress-bar {
            width: 100%; height: 6px; background: #ddd; position: fixed; top: 0; left: 0; z-index: 99;
        }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s; }

        /* RWD èª¿æ•´ */
        @media (max-width: 900px) {
            .game-wrapper { flex-direction: column; }
            .info-panel, .diagram-panel, .controls-panel { border-right: none; border-bottom: 1px solid #eee; padding: 20px; }
            .diagram-panel { order: 1; min-height: 300px; }
            .controls-panel { order: 2; }
            .info-panel { order: 3; }
            
            .game-wrapper { display: flex; flex-direction: column; }
            .info-panel { order: 1; padding-bottom: 10px; }
            .diagram-panel { order: 2; padding: 0; }
            .controls-panel { order: 3; }
            .options-grid { grid-template-columns: repeat(3, 1fr); }
        }

        .final-link {
            display: inline-block;
            margin: 30px;
            padding: 15px 40px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1.2rem;
            display: none;
        }

    </style>
</head>
<body>

    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

    <header>
        <h1>ğŸ‘¨â€âš•ï¸ ç¥ç¶“ç§‘é†«å¸«è¨ºæ–·å®¤</h1>
        <div class="subtitle">è«‹é–±è®€ç—…æ­·ï¼Œä¸¦é¸æ“‡å³å´å°æ‡‰çš„æ§‹é€ ä»£è™Ÿ</div>
    </header>

    <div class="game-wrapper">
        
        <!-- å·¦å´ï¼šè³‡è¨Šå€ -->
        <div class="info-panel">
            <div class="case-header">
                <span class="case-tag" id="case-tag">CASE 01</span>
                <span class="ai-badge" id="ai-badge">AI ç”Ÿæˆ</span>
            </div>
            
            <div class="symptom-text" id="symptom-text">
                ç—…æ‚£é€é†«æ™‚é‚„æœ‰å‘¼å¸å¿ƒè·³ï¼Œä½†é€™å¹¾å¤©è§€å¯Ÿä¸‹ä¾†ï¼Œä»–å®Œå…¨æ²’æœ‰æ„è­˜ï¼Œç„¡æ³•æ€è€ƒï¼Œå°å¤–ç•Œå‘¼å–šä¹Ÿæ²’æœ‰åæ‡‰ã€‚
            </div>

            <div class="instruction">
                ğŸ¤” è¨ºæ–·ï¼šè«‹å•æ˜¯å“ªå€‹éƒ¨ä½å—æï¼Ÿè«‹é»æ“Šå³å´æŒ‰éˆ•æˆ–åœ–ç‰‡ä¸­çš„æ§‹é€ ã€‚
            </div>

            <button class="action-btn ai-btn" id="hint-btn" onclick="getAIHint()">
                <span>âœ¨ å‘¼å« AI é¡§å•</span>
            </button>
            <div class="hint-display" id="hint-box"></div>

            <div class="feedback-box" id="feedback-box"></div>

            <button class="action-btn next-btn" id="next-btn" onclick="nextCase()">ä¸‹ä¸€ä½ç—…æ‚£ âœ</button>
            <button class="action-btn ai-gen-btn" id="ai-gen-btn" onclick="generateAICase()">âœ¨ ç”Ÿæˆ AI æ–°ç—…ä¾‹</button>
        </div>

        <!-- ä¸­é–“ï¼šåœ–ç¤ºå€ (SVG) -->
        <div class="diagram-panel">
            <svg viewBox="0 0 400 500">
                <!-- èƒŒæ™¯è¼ªå»“ -->
                <path d="M100,150 Q100,50 200,50 Q300,50 300,150 Q300,250 200,250 L200,380" fill="#f4f6f7" stroke="none"/>

                <!-- æ§‹é€ ç¹ªè£½ (åŠ å…¥ id èˆ‡ onclick) -->
                <!-- è„Šé«“ (ä¸) -->
                <path id="part-spinal" class="brain-part" onclick="checkAnswer('spinal')"
                      d="M180,220 L180,420 L220,420 L220,220 Z" fill="var(--c-spinal)" stroke="#7f8c8d" stroke-width="2"/>
                
                <!-- è…¦å¹¹ (ä¸™) -->
                <path id="part-brainstem" class="brain-part" onclick="checkAnswer('brainstem')"
                      d="M170,180 L170,230 L230,230 L230,180 Q210,170 190,170 Q180,170 170,180 Z" fill="var(--c-brainstem)" stroke="#7f8c8d" stroke-width="2"/>
                
                <!-- å°è…¦ (ä¹™) -->
                <path id="part-cerebellum" class="brain-part" onclick="checkAnswer('cerebellum')"
                      d="M220,180 Q290,180 300,220 Q290,260 230,260 Q200,260 220,180 Z" fill="var(--c-cerebellum)" stroke="#7f8c8d" stroke-width="2"/>
                
                <!-- å¤§è…¦ (ç”²) -->
                <path id="part-cerebrum" class="brain-part" onclick="checkAnswer('cerebrum')"
                      d="M130,160 Q130,50 230,50 Q310,50 310,150 Q310,180 250,180 L230,180 Q170,180 130,160" fill="var(--c-cerebrum)" stroke="#7f8c8d" stroke-width="2"/>

                <!-- æ„Ÿè¦ºç¥ç¶“ (æˆŠ) -->
                <g id="part-sensory" class="brain-part" onclick="checkAnswer('sensory')">
                    <!-- å¢åŠ é€æ˜èƒŒæ™¯è·¯å¾‘ (Hit Area) ä»¥å„ªåŒ–é»æ“Š -->
                    <path d="M65,350 Q120,350 180,360" fill="none" stroke="transparent" stroke-width="20" />
                    <!-- å¯¦é«” -->
                    <circle cx="50" cy="350" r="15" fill="var(--c-sensory)" stroke="#555" stroke-width="2"/>
                    <path d="M65,350 Q120,350 180,360" fill="none" stroke="var(--c-sensory)" stroke-width="4" stroke-dasharray="5,2"/>
                    <circle cx="160" cy="358" r="6" fill="var(--c-sensory)"/>
                </g>
                
                <!-- é‹å‹•ç¥ç¶“ (å·±) -->
                <g id="part-motor" class="brain-part" onclick="checkAnswer('motor')">
                    <!-- é€æ˜èƒŒæ™¯è·¯å¾‘ -->
                    <path d="M220,380 Q280,380 350,380" fill="none" stroke="transparent" stroke-width="20" />
                    <!-- å¯¦é«” -->
                    <path d="M220,380 Q280,380 350,380" fill="none" stroke="var(--c-motor)" stroke-width="4" stroke-dasharray="5,2"/>
                    <rect x="350" y="365" width="30" height="30" rx="5" fill="var(--c-motor)" stroke="#555" stroke-width="2"/>
                </g>

                <!-- æ¨™ç±¤èˆ‡æŒ‡å¼•ç·š (pointer-events: none) -->
                <text x="100" y="100" class="label-text">ç”²</text>
                <line x1="115" y1="100" x2="160" y2="110" class="label-line"/>
                <text x="320" y="220" class="label-text">ä¹™</text>
                <line x1="305" y1="220" x2="280" y2="215" class="label-line"/>
                <text x="110" y="215" class="label-text">ä¸™</text>
                <line x1="125" y1="215" x2="175" y2="210" class="label-line"/>
                <text x="240" y="300" class="label-text">ä¸</text>
                <line x1="230" y1="300" x2="200" y2="295" class="label-line"/>
                <text x="100" y="330" class="label-text">æˆŠ</text>
                <line x1="115" y1="330" x2="140" y2="350" class="label-line"/>
                <text x="280" y="350" class="label-text">å·±</text>
                <line x1="270" y1="350" x2="250" y2="380" class="label-line"/>
                <text x="50" y="390" font-size="16" fill="#333" font-weight="bold" text-anchor="middle">å—å™¨</text>
                <text x="365" y="415" font-size="16" fill="#333" font-weight="bold" text-anchor="middle">å‹•å™¨</text>

            </svg>
        </div>

        <!-- å³å´ï¼šæ§åˆ¶æŒ‰éˆ• (å¢åŠ  ID ä¾›é›™å‘é€£å‹•) -->
        <div class="controls-panel">
            <p style="margin:0; font-weight:bold; color:#7f8c8d;">é¸æ“‡ä»£è™Ÿï¼š</p>
            <div class="options-grid">
                <button class="option-btn" id="btn-cerebrum" onclick="checkAnswer('cerebrum')">ç”²</button>
                <button class="option-btn" id="btn-cerebellum" onclick="checkAnswer('cerebellum')">ä¹™</button>
                <button class="option-btn" id="btn-brainstem" onclick="checkAnswer('brainstem')">ä¸™</button>
                <button class="option-btn" id="btn-spinal" onclick="checkAnswer('spinal')">ä¸</button>
                <button class="option-btn" id="btn-sensory" onclick="checkAnswer('sensory')">æˆŠ</button>
                <button class="option-btn" id="btn-motor" onclick="checkAnswer('motor')">å·±</button>
            </div>
        </div>

    </div>

    <a href="3-0.html" class="final-link" id="final-link">ğŸ‰ è¨ºæ–·å®Œæˆï¼å‰å¾€å–®å…ƒ3:æ„è­˜èˆ‡åå°„</a>

    <script>
        const apiKey = ""; 

        const fixedCases = [
            { id: 1, text: "ç—…æ‚£é€é†«æ™‚é‚„æœ‰å‘¼å¸å¿ƒè·³ï¼Œä½†é€™å¹¾å¤©è§€å¯Ÿä¸‹ä¾†ï¼Œä»–å®Œå…¨æ²’æœ‰æ„è­˜ï¼Œç„¡æ³•æ€è€ƒï¼Œå°å¤–ç•Œå‘¼å–šä¹Ÿæ²’æœ‰åæ‡‰ï¼ˆé¡ä¼¼æ¤ç‰©äººç‹€æ…‹ï¼‰ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ç”² å¤§è…¦)<br>å¤§è…¦å—æå°è‡´æ„è­˜å–ªå¤±ã€‚é‚„æœ‰å‘¼å¸å¿ƒè·³è¡¨ç¤ºè…¦å¹¹æ­£å¸¸ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>é€™å€‹éƒ¨ä½å—æé€šå¸¸æœƒå½±éŸ¿å¹³è¡¡æˆ–ç”Ÿå‘½å¾µè±¡ï¼Œä½†ç—…æ‚£çš„å•é¡Œæ˜¯ã€Œæ²’æœ‰æ„è­˜ã€ã€‚" },
            { id: 2, text: "ç—…æ‚£ä¸»è¨´æœ€è¿‘èµ°è·¯ç„¡æ³•èµ°ç›´ç·šï¼Œä¸€ç›´æ–æ–æ™ƒæ™ƒï¼Œæ‹¿æ¯å­æ™‚æ‰‹ä¹ŸæœƒæŠ–å€‹ä¸åœï¼Œç„¡æ³•æº–ç¢ºæŠ“æ¡ã€‚", answer: "cerebellum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ä¹™ å°è…¦)<br>å°è…¦è² è²¬å”èª¿è‚Œè‚‰èˆ‡å¹³è¡¡ã€‚èµ°è·¯æ–æ™ƒæ˜¯å…¸å‹ç—‡ç‹€ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>ç—…æ‚£æ„è­˜æ¸…æ¥šï¼Œä¸»è¦æ˜¯ã€Œå‹•ä½œå”èª¿ã€å‡ºäº†å•é¡Œã€‚" },
            { id: 3, text: "é€™æ˜¯ä¸€èµ·åš´é‡è»Šç¦ï¼Œç—…æ‚£åˆ°é™¢å‰å·²ç¶“åœæ­¢å‘¼å¸èˆ‡å¿ƒè·³ï¼Œç¶“éæ€¥æ•‘ä»å®£å‘Šä¸æ²»ã€‚", answer: "brainstem", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ä¸™ è…¦å¹¹)<br>è…¦å¹¹æ˜¯ç”Ÿå‘½ä¸­æ¨ï¼Œæ§åˆ¶å‘¼å¸å¿ƒè·³ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>å–ªå¤±ç”Ÿå‘½å¾µè±¡æ˜¯æ›´æ·±å±¤çš„ä¸­æ¨æ§åˆ¶çš„ã€‚" },
            { id: 4, text: "ç—…æ‚£å¾é«˜è™•è·Œè½å¾Œï¼Œè…°éƒ¨ä»¥ä¸‹å®Œå…¨å¤±å»çŸ¥è¦ºï¼ˆä¸‹åŠèº«ç™±ç˜“ï¼‰ï¼Œä¹Ÿç„¡æ³•æ§åˆ¶æ’ä¾¿ï¼Œä½†æ‰‹éƒ¨æ´»å‹•æ­£å¸¸ï¼Œæ„è­˜ä¹Ÿæ¸…é†’ã€‚", answer: "spinal", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ä¸ è„Šé«“)<br>è„Šé«“å—æå°è‡´è¨Šè™Ÿç„¡æ³•å‚³åˆ°ä¸‹åŠèº«ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>å•é¡Œå‡ºåœ¨è¨Šè™Ÿå‚³å°ä¸­æ–·ï¼Œè€Œéå¤§è…¦æ€è€ƒå•é¡Œã€‚" },
            { id: 5, text: "ç—…æ‚£ä¸­é¢¨å¾Œï¼Œé›–ç„¶è½å¾—æ‡‚åˆ¥äººåœ¨èªªä»€éº¼ï¼Œä½†è‡ªå·±å»ç„¡æ³•èªªå‡ºæµæš¢çš„å¥å­ï¼ˆå¤±èªç—‡ï¼‰ï¼Œæˆ–æ˜¯è¨˜ä¸ä½å®¶äººçš„åå­—ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ç”² å¤§è…¦)<br>èªè¨€èˆ‡è¨˜æ†¶æ˜¯å¤§è…¦çš„é«˜ç´šåŠŸèƒ½ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>èªè¨€èˆ‡è¨˜æ†¶åŠŸèƒ½ä¸åœ¨é€™è£¡ã€‚" },
            { id: 6, text: "ã€æŒ‘æˆ°é¡Œã€‘ç—…æ‚£çœ¼ç›é‡åˆ°å¼·å…‰ç³å­”æœƒç¸®å°ï¼ˆåå°„æ­£å¸¸ï¼‰ï¼Œä½†æ˜¯ä½ å«ä»–ç®—ã€Œ3+2=ï¼Ÿã€ä»–å»ç®—ä¸å‡ºä¾†ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ç”² å¤§è…¦)<br>ç³å­”åå°„(è…¦å¹¹)æ­£å¸¸ï¼Œä½†ç„¡æ³•é‹ç®—ä»£è¡¨å¤§è…¦å—æã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>é™·é˜±é¡Œï¼åå°„æ­£å¸¸ä»£è¡¨è…¦å¹¹æ²’äº‹ï¼Œç®—æ•¸å­¸æ˜¯èª°ç®¡çš„ï¼Ÿ" },
            { id: 7, text: "ã€æŒ‘æˆ°é¡Œã€‘ç—…æ‚£æ„Ÿè¦ºèº«é«”é€æ¼¸ç„¡åŠ›ï¼Œæ‰‹è…³è‚Œè‚‰é–‹å§‹èç¸®ã€‚ä½†æ˜¯ä»–çš„æ„Ÿè¦ºæ­£å¸¸ï¼ˆè¢«ææœƒç—›ï¼‰ï¼Œæ„è­˜ä¹Ÿéå¸¸æ¸…æ¥šã€‚", answer: "motor", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(å·± é‹å‹•ç¥ç¶“å…ƒ)<br>æ„Ÿè¦ºæ­£å¸¸ã€æ„è­˜æ¸…æ¥šï¼Œä½†è‚Œè‚‰ç„¡åŠ›ï¼Œæ˜¯é‹å‹•ç¥ç¶“å…ƒçš„å•é¡Œï¼ˆå¦‚æ¼¸å‡äººï¼‰ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>æ„Ÿè¦ºæ­£å¸¸ä»£è¡¨å—å™¨èˆ‡æ„Ÿè¦ºç¥ç¶“æ²’å£ï¼Œæ„è­˜æ¸…æ¥šä»£è¡¨å¤§è…¦æ²’å£ã€‚" }
        ];

        let currentIdx = 0;
        let isSolved = false;
        let currentCase = null;

        function init() {
            renderCase(fixedCases[0]);
        }

        function renderCase(caseData) {
            currentCase = caseData;
            isSolved = false;
            
            const caseTitle = caseData.isAI ? `AI CASE` : `CASE 0${currentIdx + 1}`;
            document.getElementById('case-tag').innerText = caseTitle;
            document.getElementById('symptom-text').innerText = caseData.text;
            document.getElementById('ai-badge').style.display = caseData.isAI ? 'inline-block' : 'none';

            // Reset UI
            document.getElementById('feedback-box').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('ai-gen-btn').style.display = 'none';
            document.getElementById('hint-box').style.display = 'none';
            document.getElementById('hint-btn').disabled = false;
            document.getElementById('hint-btn').innerHTML = '<span>âœ¨ å‘¼å« AI é¡§å•</span>';
            
            // Reset visual states (SVG & Buttons)
            document.querySelectorAll('.brain-part, .brain-group').forEach(el => {
                el.classList.remove('svg-correct', 'svg-wrong');
            });
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.className = 'option-btn'; // remove correct/wrong
                btn.disabled = false;
            });

            // Progress bar
            if (!caseData.isAI) {
                const percent = (currentIdx / fixedCases.length) * 100;
                document.getElementById('progress-fill').style.width = `${percent}%`;
            } else {
                document.getElementById('progress-fill').style.width = '100%';
            }
        }

        function checkAnswer(partId) {
            if (isSolved) return;

            const feedbackBox = document.getElementById('feedback-box');
            feedbackBox.style.display = 'block';

            // å–å¾—å°æ‡‰çš„æŒ‰éˆ•èˆ‡ SVG å…ƒç´ 
            const btnElement = document.getElementById('btn-' + partId);
            const svgElement = document.getElementById('part-' + partId);

            if (partId === currentCase.answer) {
                isSolved = true;
                feedbackBox.innerHTML = currentCase.correctMsg;
                feedbackBox.className = "feedback-box correct";
                
                // é›™å‘äº®ç‡ˆ
                if(btnElement) btnElement.classList.add('correct');
                if(svgElement) svgElement.classList.add('svg-correct');
                
                // Disable all buttons
                document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

                if (!currentCase.isAI && currentIdx < fixedCases.length - 1) {
                    document.getElementById('next-btn').style.display = 'block';
                } else {
                    document.getElementById('ai-gen-btn').style.display = 'block';
                    document.getElementById('final-link').style.display = 'inline-block';
                    document.getElementById('progress-fill').style.width = '100%';
                }

            } else {
                feedbackBox.innerHTML = currentCase.wrongMsg || "âŒ è¨ºæ–·éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
                feedbackBox.className = "feedback-box wrong";
                
                // éŒ¯èª¤ç‰¹æ•ˆ
                if(btnElement) {
                    btnElement.classList.add('wrong');
                    setTimeout(() => btnElement.classList.remove('wrong'), 500);
                }
                if(svgElement) {
                    svgElement.classList.add('svg-wrong');
                    setTimeout(() => svgElement.classList.remove('svg-wrong'), 500);
                }
            }
        }

        function nextCase() {
            if (currentIdx < fixedCases.length - 1) {
                currentIdx++;
                renderCase(fixedCases[currentIdx]);
            }
        }

        // --- AI Functions ---
        async function getAIHint() {
            const btn = document.getElementById('hint-btn');
            const hintBox = document.getElementById('hint-box');
            
            btn.disabled = true;
            btn.innerHTML = 'Thinking...';

            const prompt = `
                ä½ æ˜¯ä¸€ä½ç”Ÿç‰©è€å¸«ã€‚å­¸ç”Ÿæ­£åœ¨ç©è¨ºæ–·éŠæˆ²ã€‚
                ç—…ä¾‹ç—‡ç‹€ï¼šã€Œ${currentCase.text}ã€ã€‚
                è«‹çµ¦ä¸€å€‹ç°¡çŸ­æç¤ºï¼Œå¼•å°ä»–æ€è€ƒå—æéƒ¨ä½(å¤§è…¦/å°è…¦/è…¦å¹¹/è„Šé«“/æ„Ÿè¦º/é‹å‹•ç¥ç¶“)ï¼Œä½†ä¸è¦ç›´æ¥èªªå‡ºç­”æ¡ˆã€‚
                ç”¨ç¹é«”ä¸­æ–‡ï¼Œ50å­—å…§ã€‚
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                const hintText = data.candidates[0].content.parts[0].text;
                
                hintBox.style.display = 'block';
                hintBox.innerHTML = `<strong>ğŸ’¡ AI æç¤ºï¼š</strong><br>${hintText}`;
            } catch (e) {
                console.error(e);
                hintBox.style.display = 'block';
                hintBox.innerText = "AI é€£ç·šå¿™ç¢Œä¸­";
            } finally {
                btn.innerHTML = '<span>âœ¨ å‘¼å« AI é¡§å•</span>';
            }
        }

        async function generateAICase() {
            const btn = document.getElementById('ai-gen-btn');
            btn.disabled = true;
            btn.innerHTML = 'Generating...';

            const prompt = `
                ç”Ÿæˆä¸€å€‹åœ‹ä¸­ç”Ÿç‰©ã€Œç¥ç¶“ç³»çµ±å—æç—…ä¾‹ã€ã€‚
                éƒ¨ä½é¸æ“‡: cerebrum, cerebellum, brainstem, spinal, sensory, motor
                å›å‚³ JSON: { "text": "ç—‡ç‹€æè¿°", "answer": "éƒ¨ä½ä»£ç¢¼", "correctMsg": "è©³è§£", "wrongMsg": "éŒ¯èª¤æç¤º" }
                ç¹é«”ä¸­æ–‡ã€‚
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await response.json();
                const aiCaseData = JSON.parse(data.candidates[0].content.parts[0].text);
                aiCaseData.isAI = true;
                renderCase(aiCaseData);
            } catch (e) {
                console.error(e);
                alert("AI ç”Ÿæˆå¤±æ•—");
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'âœ¨ ç”Ÿæˆ AI æ–°ç—…ä¾‹';
            }
        }

        init();
    </script>
</body>
</html>
