<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç¶“ç§‘é†«å¸«è¨ºæ–·å®¤</title>
    <style>
        * { box-sizing: border-box; }

        :root {
            --primary: #2c3e50;
            --accent: #16a085;
            --bg-color: #f0f2f5;
            --text-color: #2c3e50;
            --btn-bg: #fff;
            --btn-hover: #e8f8f5;
            /* è…¦éƒ¨é¡è‰² */
            --c-cerebrum: #e5989b;
            --c-cerebellum: #ffb703;
            --c-brainstem: #8ecae6;
            --c-spinal: #cdb4db;
            --c-sensory: #a2d2ff;
            --c-motor: #ffafcc;
            --selected-color: #3498db;
        }

        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
        }

        header {
            width: 100%;
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.6rem; }
        .subtitle { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }

        /* --- ä¸»ç‰ˆé¢ --- */
        .game-wrapper {
            display: flex;
            flex-direction: column; /* æ”¹ç‚ºå‚ç›´æ’åˆ—ï¼Œä¸Šæ–¹æ”¾é¡Œç›® */
            width: 95%;
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
            min-height: 600px;
        }

        /* 1. ä¸Šæ–¹ï¼šç—…æ­·å€ */
        .top-case-panel {
            padding: 25px;
            background-color: #fcfcfc;
            border-bottom: 1px solid #eee;
        }

        .case-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .case-tag { background: var(--primary); color: white; padding: 4px 10px; border-radius: 4px; font-weight: bold; font-size: 0.9rem; }
        
        .symptom-text {
            font-size: 1.3rem;
            line-height: 1.5;
            font-weight: bold;
            color: #34495e;
        }

        /* ä¸‹æ–¹å…§å®¹å€ (åœ– + æ§åˆ¶) */
        .content-row {
            display: flex;
            flex: 1;
        }

        /* 2. å·¦å´ï¼šè§£å‰–åœ– */
        .diagram-panel {
            flex: 1.5;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            border-right: 1px solid #eee;
            position: relative;
            padding: 10px;
        }

        /* 3. å³å´ï¼šä½œç­”æ§åˆ¶å€ */
        .controls-panel {
            flex: 1;
            padding: 30px;
            background-color: #f8f9fa;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* é ä¸Šå°é½Š */
            gap: 20px;
        }

        .instruction {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            font-size: 1rem;
            color: #555;
            border-left: 4px solid var(--accent);
        }

        /* å¡«ç­”å€æ¨£å¼ */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }

        .input-label {
            font-weight: bold;
            color: #555;
            font-size: 1.1rem;
        }

        .answer-input {
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1.2rem;
            width: 100%;
            transition: border-color 0.3s;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .submit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 10px;
        }

        .submit-btn:hover { background: #1a252f; }
        .submit-btn:disabled { background: #95a5a6; cursor: not-allowed; }

        /* SVG æ¨£å¼ */
        svg { width: 100%; height: auto; max-height: 500px; touch-action: manipulation; }
        .label-text { font-size: 24px; font-weight: bold; fill: #333; text-anchor: middle; dominant-baseline: middle; pointer-events: none; }
        .label-line { stroke: #555; stroke-width: 2; pointer-events: none; }

        /* äº’å‹•æ•ˆæœ */
        .brain-part, .brain-group { cursor: pointer; transition: opacity 0.2s; }
        .brain-part:hover, .brain-group:hover { opacity: 0.7; }

        /* é¸å–ç‹€æ…‹ */
        .selected-highlight {
            stroke: var(--selected-color) !important;
            stroke-width: 5px !important;
            stroke-dasharray: 8 4 !important;
            animation: pulse-border 1.5s infinite;
        }
        
        g.selected-highlight circle, g.selected-highlight rect {
            stroke: var(--selected-color) !important;
            stroke-width: 4px !important;
        }
        g.selected-highlight path {
            stroke: var(--selected-color) !important;
        }

        /* ç­”å°/ç­”éŒ¯æ¨£å¼ */
        .correct-highlight { fill: #27ae60 !important; stroke: #27ae60 !important; }
        .wrong-highlight { fill: #e74c3c !important; stroke: #c0392b !important; }

        g.correct-highlight circle, g.correct-highlight rect { fill: #27ae60 !important; stroke: #27ae60 !important; }
        g.correct-highlight path { fill: none !important; stroke: #27ae60 !important; }

        g.wrong-highlight circle, g.wrong-highlight rect { fill: #e74c3c !important; stroke: #c0392b !important; }
        g.wrong-highlight path { fill: none !important; stroke: #c0392b !important; }

        @keyframes pulse-border {
            0% { stroke-opacity: 1; }
            50% { stroke-opacity: 0.5; }
            100% { stroke-opacity: 1; }
        }

        /* å›é¥‹å€ */
        .feedback-box {
            padding: 15px;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.5s;
            line-height: 1.5;
        }
        .feedback-box.correct { background: #d5f5e3; color: #145a32; border: 1px solid #27ae60; }
        .feedback-box.wrong { background: #fadbd8; color: #7b241c; border: 1px solid #c0392b; }

        /* ä¸‹ä¸€é æŒ‰éˆ• */
        .next-btn { 
            background: var(--accent); 
            color: white; 
            padding: 12px;
            border-radius: 50px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            display: none;
            transition: transform 0.2s;
            width: 100%;
        }
        .next-btn:hover { background: #1abc9c; transform: scale(1.02); }

        .progress-bar { width: 100%; height: 6px; background: #ddd; position: fixed; top: 0; left: 0; z-index: 99; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s; }

        @media (max-width: 900px) {
            .content-row { flex-direction: column; }
            .diagram-panel { border-right: none; border-bottom: 1px solid #eee; min-height: 350px; }
            .controls-panel { padding: 20px; }
        }

        .final-link {
            display: inline-block;
            margin: 30px;
            padding: 15px 40px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1.2rem;
            display: none;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

    <header>
        <h1>ğŸ‘¨â€âš•ï¸ ç¥ç¶“ç§‘é†«ç”Ÿè¨ºæ–·å®¤</h1>
        <div class="subtitle">é›™é‡é©—è­‰ï¼šè«‹é»é¸åœ–ä¸­æ§‹é€ ï¼Œä¸¦è¼¸å…¥æ­£ç¢ºåç¨±</div>
    </header>

    <div class="game-wrapper">
        
        <!-- ä¸Šæ–¹ï¼šç—…æ­·è³‡è¨Š -->
        <div class="top-case-panel">
            <div class="case-header">
                <span class="case-tag" id="case-tag">CASE 01</span>
            </div>
            <div class="symptom-text" id="symptom-text">
                ç—…æ‚£é€é†«æ™‚é‚„æœ‰å‘¼å¸å¿ƒè·³ï¼Œä½†é€™å¹¾å¤©è§€å¯Ÿä¸‹ä¾†ï¼Œä»–å®Œå…¨æ²’æœ‰æ„è­˜ï¼Œç„¡æ³•æ€è€ƒï¼Œå°å¤–ç•Œå‘¼å–šä¹Ÿæ²’æœ‰åæ‡‰ã€‚
            </div>
        </div>

        <!-- ä¸‹æ–¹å…§å®¹ï¼šåœ– + æ§åˆ¶ -->
        <div class="content-row">
            
            <!-- å·¦/ä¸Šï¼šè§£å‰–åœ– (SVG) -->
            <div class="diagram-panel">
                <svg viewBox="0 0 400 500">
                    <path d="M100,150 Q100,50 200,50 Q300,50 300,150 Q300,250 200,250 L200,380" fill="#f4f6f7" stroke="none"/>

                    <!-- è„Šé«“ (ä¸) -->
                    <path id="part-spinal" class="brain-part" onclick="selectPart('spinal')"
                          d="M180,220 L180,420 L220,420 L220,220 Z" fill="var(--c-spinal)" stroke="#7f8c8d" stroke-width="2"/>
                    
                    <!-- è…¦å¹¹ (ä¸™) -->
                    <path id="part-brainstem" class="brain-part" onclick="selectPart('brainstem')"
                          d="M170,180 L170,230 L230,230 L230,180 Q210,170 190,170 Q180,170 170,180 Z" fill="var(--c-brainstem)" stroke="#7f8c8d" stroke-width="2"/>
                    
                    <!-- å°è…¦ (ä¹™) -->
                    <path id="part-cerebellum" class="brain-part" onclick="selectPart('cerebellum')"
                          d="M220,180 Q290,180 300,220 Q290,260 230,260 Q200,260 220,180 Z" fill="var(--c-cerebellum)" stroke="#7f8c8d" stroke-width="2"/>
                    
                    <!-- å¤§è…¦ (ç”²) -->
                    <path id="part-cerebrum" class="brain-part" onclick="selectPart('cerebrum')"
                          d="M130,160 Q130,50 230,50 Q310,50 310,150 Q310,180 250,180 L230,180 Q170,180 130,160" fill="var(--c-cerebrum)" stroke="#7f8c8d" stroke-width="2"/>

                    <!-- æ„Ÿè¦ºç¥ç¶“ (æˆŠ) -->
                    <g id="part-sensory" class="brain-group" onclick="selectPart('sensory')">
                        <path d="M65,350 Q120,350 180,360" fill="none" stroke="transparent" stroke-width="20" />
                        <circle cx="50" cy="350" r="15" fill="var(--c-sensory)" stroke="#555" stroke-width="2"/>
                        <path d="M65,350 Q120,350 180,360" fill="none" stroke="var(--c-sensory)" stroke-width="4" stroke-dasharray="5,2"/>
                        <circle cx="160" cy="358" r="6" fill="var(--c-sensory)"/>
                    </g>
                    
                    <!-- é‹å‹•ç¥ç¶“ (å·±) -->
                    <g id="part-motor" class="brain-group" onclick="selectPart('motor')">
                        <path d="M220,380 Q280,380 350,380" fill="none" stroke="transparent" stroke-width="20" />
                        <path d="M220,380 Q280,380 350,380" fill="none" stroke="var(--c-motor)" stroke-width="4" stroke-dasharray="5,2"/>
                        <rect x="350" y="365" width="30" height="30" rx="5" fill="var(--c-motor)" stroke="#555" stroke-width="2"/>
                    </g>

                    <!-- æ¨™ç±¤ -->
                    <text x="100" y="100" class="label-text">ç”²</text>
                    <line x1="125" y1="95" x2="160" y2="110" class="label-line"/>
                    <text x="320" y="220" class="label-text">ä¹™</text>
                    <line x1="305" y1="220" x2="280" y2="215" class="label-line"/>
                    <text x="110" y="215" class="label-text">ä¸™</text>
                    <line x1="125" y1="215" x2="175" y2="210" class="label-line"/>
                    <text x="240" y="300" class="label-text">ä¸</text>
                    <line x1="230" y1="300" x2="200" y2="295" class="label-line"/>
                    <text x="100" y="330" class="label-text">æˆŠ</text>
                    <line x1="115" y1="330" x2="140" y2="350" class="label-line"/>
                    <text x="280" y="350" class="label-text">å·±</text>
                    <line x1="270" y1="350" x2="250" y2="380" class="label-line"/>
                    <text x="20" y="390" font-size="16" fill="#333" font-weight="bold" text-anchor="middle">å—å™¨</text>
                    <line x1="45" y1="380" x2="50" y2="365" stroke="#555" stroke-width="2"/>
                    <text x="365" y="415" font-size="16" fill="#333" font-weight="bold" text-anchor="middle">å‹•å™¨</text>
                    <line x1="355" y1="400" x2="355" y2="395" stroke="#555" stroke-width="2"/>
                </svg>
            </div>

            <!-- å³/ä¸‹ï¼šå¡«ç­”æ§åˆ¶å€ -->
            <div class="controls-panel">
                <div class="instruction">
                    ğŸ¤” <strong>è¨ºæ–·æ­¥é©Ÿï¼š</strong><br>
                    1. é»é¸å·¦åœ–çš„å—æéƒ¨ä½ã€‚<br>
                    2. è¼¸å…¥è©²éƒ¨ä½çš„ä¸­æ–‡åç¨±ã€‚<br>
                    3. æŒ‰ä¸‹ã€Œé€å‡ºè¨ºæ–·ã€ã€‚
                </div>

                <div class="input-group">
                    <div>
                        <label class="input-label">1. æ‚¨é»é¸çš„éƒ¨ä½ï¼š</label>
                        <span id="selected-part-display" style="color:#7f8c8d; font-style:italic; margin-left:5px;">(å°šæœªé»é¸)</span>
                    </div>
                    
                    <div>
                        <label class="input-label">2. æ§‹é€ åç¨±ï¼š</label>
                        <input type="text" class="answer-input" id="answer-input" placeholder="ä¾‹å¦‚ï¼šå¤§è…¦" onkeypress="handleEnter(event)">
                    </div>
                    
                    <button class="submit-btn" id="submit-btn" onclick="checkDiagnosis()">é€å‡ºè¨ºæ–·</button>
                </div>

                <div class="feedback-box" id="feedback-box"></div>
                <button class="next-btn" id="next-btn" onclick="nextCase()">ä¸‹ä¸€ä½ç—…æ‚£ âœ</button>
            </div>

        </div>
    </div>

    <a href="3-0.html" class="final-link" id="final-link">ğŸ‰ è¨ºæ–·å®Œæˆï¼å‰å¾€ä¸‹ä¸€é—œ</a>

    <script>
        // æ­£ç¢ºåç¨±å°ç…§è¡¨
        const partNames = {
            "cerebrum": ["å¤§è…¦"],
            "cerebellum": ["å°è…¦"],
            "brainstem": ["è…¦å¹¹"],
            "spinal": ["è„Šé«“"],
            "sensory": ["æ„Ÿè¦ºç¥ç¶“å…ƒ", "æ„Ÿè¦ºç¥ç¶“"],
            "motor": ["é‹å‹•ç¥ç¶“å…ƒ", "é‹å‹•ç¥ç¶“"]
        };

        const fixedCases = [
            { id: 1, text: "ç—…æ‚£é€é†«æ™‚é‚„æœ‰å‘¼å¸å¿ƒè·³ï¼Œä½†é€™å¹¾å¤©è§€å¯Ÿä¸‹ä¾†ï¼Œä»–å®Œå…¨æ²’æœ‰æ„è­˜ï¼Œç„¡æ³•æ€è€ƒï¼Œå°å¤–ç•Œå‘¼å–šä¹Ÿæ²’æœ‰åæ‡‰ï¼ˆé¡ä¼¼æ¤ç‰©äººç‹€æ…‹ï¼‰ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼<br>å¤§è…¦å—æå°è‡´æ„è­˜å–ªå¤±ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>æç¤ºï¼šæ„è­˜èˆ‡æ€è€ƒæ˜¯å¤§è…¦çš„åŠŸèƒ½ã€‚" },
            { id: 2, text: "ç—…æ‚£ä¸»è¨´æœ€è¿‘èµ°è·¯ç„¡æ³•èµ°ç›´ç·šï¼Œä¸€ç›´æ–æ–æ™ƒæ™ƒï¼Œæ‹¿æ¯å­æ™‚æ‰‹ä¹ŸæœƒæŠ–å€‹ä¸åœï¼Œç„¡æ³•æº–ç¢ºæŠ“æ¡ã€‚", answer: "cerebellum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼<br>å°è…¦è² è²¬å”èª¿è‚Œè‚‰èˆ‡å¹³è¡¡ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>æç¤ºï¼šæ„è­˜æ¸…æ¥šï¼Œä½†å‹•ä½œä¸å”èª¿ï¼Œåƒå–é†‰é…’ã€‚" },
            { id: 3, text: "é€™æ˜¯ä¸€èµ·åš´é‡è»Šç¦ï¼Œç—…æ‚£åˆ°é™¢å‰å·²ç¶“åœæ­¢å‘¼å¸èˆ‡å¿ƒè·³ï¼Œç¶“éæ€¥æ•‘ä»å®£å‘Šä¸æ²»ã€‚", answer: "brainstem", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼<br>è…¦å¹¹æ˜¯ç”Ÿå‘½ä¸­æ¨ï¼Œæ§åˆ¶å‘¼å¸å¿ƒè·³ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>æç¤ºï¼šæŒç®¡ç”Ÿå‘½å¾µè±¡ï¼ˆå¿ƒè·³å‘¼å¸ï¼‰çš„ä¸­æ¨ã€‚" },
            { id: 4, text: "ç—…æ‚£å¾é«˜è™•è·Œè½å¾Œï¼Œè…°éƒ¨ä»¥ä¸‹å®Œå…¨å¤±å»çŸ¥è¦ºï¼ˆä¸‹åŠèº«ç™±ç˜“ï¼‰ï¼Œä¹Ÿç„¡æ³•æ§åˆ¶æ’ä¾¿ï¼Œä½†æ‰‹éƒ¨æ´»å‹•æ­£å¸¸ï¼Œæ„è­˜ä¹Ÿæ¸…é†’ã€‚", answer: "spinal", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼<br>è„Šé«“å—æå°è‡´è¨Šè™Ÿç„¡æ³•å‚³åˆ°ä¸‹åŠèº«ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>æç¤ºï¼šè…¦éƒ¨åŠŸèƒ½æ­£å¸¸ï¼Œæ˜¯å‚³å°è·¯å¾‘æ–·äº†ã€‚" },
            { id: 5, text: "ç—…æ‚£ä¸­é¢¨å¾Œï¼Œé›–ç„¶è½å¾—æ‡‚åˆ¥äººåœ¨èªªä»€éº¼ï¼Œä½†è‡ªå·±å»ç„¡æ³•èªªå‡ºæµæš¢çš„å¥å­ï¼ˆå¤±èªç—‡ï¼‰ï¼Œæˆ–æ˜¯è¨˜ä¸ä½å®¶äººçš„åå­—ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼<br>èªè¨€èˆ‡è¨˜æ†¶æ˜¯å¤§è…¦çš„é«˜ç´šåŠŸèƒ½ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>æç¤ºï¼šèªè¨€ã€è¨˜æ†¶ã€å­¸ç¿’éƒ½æ­¸å®ƒç®¡ã€‚" },
            { id: 6, text: "ã€æŒ‘æˆ°é¡Œã€‘ç—…æ‚£çœ¼ç›é‡åˆ°å¼·å…‰ç³å­”æœƒç¸®å°ï¼ˆåå°„æ­£å¸¸ï¼‰ï¼Œä½†æ˜¯ä½ å«ä»–ç®—ã€Œ3+2=ï¼Ÿã€ä»–å»ç®—ä¸å‡ºä¾†ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼<br>é‹ç®—æ˜¯å¤§è…¦çš„åŠŸèƒ½ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>æç¤ºï¼šåå°„æ­£å¸¸ä»£è¡¨è…¦å¹¹æ²’äº‹ï¼Œç®—æ•¸å­¸æ˜¯èª°è² è²¬ï¼Ÿ" },
            { id: 7, text: "ã€æŒ‘æˆ°é¡Œã€‘ç—…æ‚£æ„Ÿè¦ºèº«é«”é€æ¼¸ç„¡åŠ›ï¼Œæ‰‹è…³è‚Œè‚‰é–‹å§‹èç¸®ã€‚ä½†æ˜¯ä»–çš„æ„Ÿè¦ºæ­£å¸¸ï¼ˆè¢«ææœƒç—›ï¼‰ï¼Œæ„è­˜ä¹Ÿéå¸¸æ¸…æ¥šã€‚", answer: "motor", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼<br>é€™æ˜¯é‹å‹•ç¥ç¶“å…ƒç–¾ç—…ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>æç¤ºï¼šæ„Ÿè¦ºæ­£å¸¸ã€æ„è­˜æ¸…æ¥šï¼Œä½†è‚Œè‚‰æ”¶ä¸åˆ°å‘½ä»¤ã€‚" }
        ];

        let currentIdx = 0;
        let isSolved = false;
        let currentCase = null;
        let selectedPartId = null;

        function init() {
            renderCase(fixedCases[0]);
        }

        function renderCase(caseData) {
            currentCase = caseData;
            isSolved = false;
            selectedPartId = null;
            
            document.getElementById('case-tag').innerText = `CASE 0${currentIdx + 1}`;
            document.getElementById('symptom-text').innerText = caseData.text;

            // Reset UI
            document.getElementById('feedback-box').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').disabled = false;
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('selected-part-display').innerText = "(å°šæœªé»é¸)";
            document.getElementById('selected-part-display').style.color = "#7f8c8d";
            document.getElementById('selected-part-display').style.fontWeight = "normal";
            
            // Clear SVG styles
            document.querySelectorAll('.brain-part, .brain-group').forEach(el => {
                el.classList.remove('selected-highlight', 'correct-highlight', 'wrong-highlight');
                el.style.pointerEvents = 'auto';
            });

            // Progress bar
            const percent = (currentIdx / fixedCases.length) * 100;
            document.getElementById('progress-fill').style.width = `${percent}%`;
        }

        // é»é¸åœ–ç‰‡éƒ¨ä½
        function selectPart(partId) {
            if (isSolved) return;

            selectedPartId = partId;
            
            // æ¸…é™¤å…¶ä»–é¸å–ç‹€æ…‹
            document.querySelectorAll('.brain-part, .brain-group').forEach(el => {
                el.classList.remove('selected-highlight');
            });

            // åŠ ä¸Šé¸å–ç‹€æ…‹
            const clickedEl = document.getElementById('part-' + partId);
            clickedEl.classList.add('selected-highlight');

            // æ–‡å­—å›é¥‹
            const display = document.getElementById('selected-part-display');
            display.innerText = "å·²é¸å–";
            display.style.color = "var(--selected-color)";
            display.style.fontWeight = "bold";
        }

        function handleEnter(e) {
            if (e.key === 'Enter') checkDiagnosis();
        }

        function checkDiagnosis() {
            if (isSolved) return;

            const inputVal = document.getElementById('answer-input').value.trim();
            const feedbackBox = document.getElementById('feedback-box');
            
            if (!selectedPartId) {
                alert("è«‹å…ˆåœ¨åœ–ç‰‡ä¸Šé»é¸å—æéƒ¨ä½ï¼");
                return;
            }
            if (!inputVal) {
                alert("è«‹è¼¸å…¥è©²éƒ¨ä½çš„ä¸­æ–‡åç¨±ï¼");
                return;
            }

            feedbackBox.style.display = 'block';
            
            const isPartCorrect = (selectedPartId === currentCase.answer);
            const correctNames = partNames[currentCase.answer];
            const isNameCorrect = correctNames.includes(inputVal);

            const partEl = document.getElementById('part-' + selectedPartId);
            partEl.classList.remove('selected-highlight');

            if (isPartCorrect && isNameCorrect) {
                // Correct
                isSolved = true;
                feedbackBox.innerHTML = currentCase.correctMsg;
                feedbackBox.className = "feedback-box correct";
                partEl.classList.add('correct-highlight');
                
                document.getElementById('answer-input').disabled = true;
                document.getElementById('submit-btn').disabled = true;
                document.querySelectorAll('.brain-part, .brain-group').forEach(el => el.style.pointerEvents = 'none');

                if (currentIdx < fixedCases.length - 1) {
                    document.getElementById('next-btn').style.display = 'block';
                } else {
                    document.getElementById('final-link').style.display = 'inline-block';
                    document.getElementById('progress-fill').style.width = '100%';
                }

            } else {
                // Wrong
                let msg = "";
                if (!isPartCorrect && !isNameCorrect) {
                    msg = "âŒ éƒ¨ä½é»éŒ¯äº†ï¼Œåç¨±ä¹Ÿä¸å°å–”ï¼è«‹å†è©¦è©¦ã€‚";
                } else if (!isPartCorrect) {
                    msg = "âŒ åç¨±å¯«å°äº†ï¼Œä½†åœ–ç‰‡ä½ç½®é»éŒ¯å›‰ï¼";
                } else {
                    msg = "âŒ åœ–ç‰‡ä½ç½®å°äº†ï¼Œä½†åç¨±å¯«éŒ¯å›‰ï¼<br>(è«‹ç¢ºèªæ˜¯å¦ç‚ºæ¨™æº–ä¸­æ–‡åç¨±)";
                }
                
                feedbackBox.innerHTML = msg;
                feedbackBox.className = "feedback-box wrong";
                partEl.classList.add('wrong-highlight');
                
                setTimeout(() => {
                    partEl.classList.remove('wrong-highlight');
                }, 1000);
            }
        }

        function nextCase() {
            if (currentIdx < fixedCases.length - 1) {
                currentIdx++;
                renderCase(fixedCases[currentIdx]);
            }
        }

        init();
    </script>
</body>
</html>
