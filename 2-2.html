<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç¶“ç§‘é†«å¸«è¨ºæ–·å®¤ + AI æ™ºæ…§åŠ©æ‰‹</title>
    <style>
        :root {
            --primary: #34495e;
            --accent: #1abc9c;
            --bg-color: #f4f6f7;
            --text-color: #2c3e50;
            --highlight: #e74c3c;
            /* è…¦éƒ¨é¡è‰²å®šç¾© */
            --cerebrum-color: #e5989b;
            --cerebellum-color: #ffb703;
            --brainstem-color: #8ecae6;
            --spinal-color: #cdb4db;
            --sensory-color: #a2d2ff;
            --motor-color: #ffafcc;
            --ai-color: #8e44ad;
        }

        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
        }

        header {
            width: 100%;
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.8rem; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .subtitle { font-size: 1rem; opacity: 0.8; margin-top: 5px; }

        /* --- ä¸»å€åŸŸ (å·¦å³ä½ˆå±€) --- */
        .main-container {
            display: flex;
            flex-direction: row;
            width: 95%;
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            overflow: hidden;
            min-height: 550px;
        }

        /* å·¦å´ï¼šç—…æ­·è¡¨ */
        .chart-panel {
            flex: 1;
            padding: 30px;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .case-number {
            color: var(--accent);
            font-weight: bold;
            letter-spacing: 2px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-badge {
            background-color: var(--ai-color);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            display: none;
        }

        .symptom-box {
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 20px;
            font-weight: bold;
            min-height: 100px;
        }

        .instruction {
            color: #7f8c8d;
            font-size: 0.95rem;
            margin-bottom: 20px;
            padding: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            border-left: 4px solid var(--primary);
        }

        /* å³å´ï¼šäº’å‹•åœ– */
        .diagram-panel {
            flex: 1;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 20px;
        }

        /* SVG æ¨£å¼ */
        svg {
            max-width: 100%;
            height: auto;
            max-height: 550px;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1));
        }

        .brain-part {
            stroke: #7f8c8d;
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s;
            /* ç§»é™¤é è¨­çš„ fill: #ecf0f1ï¼Œé¿å…è¦†è“‹é¡è‰² */
        }

        .brain-part:hover {
            filter: brightness(0.95);
            stroke: var(--primary);
            stroke-width: 4;
        }

        /* å¼·åˆ¶æŒ‡å®šå„éƒ¨ä½é¡è‰²ï¼Œè§£æ±ºé¡è‰²ä¸é¡¯ç¤ºçš„å•é¡Œ */
        #part-cerebrum { fill: var(--cerebrum-color); }
        #part-cerebellum { fill: var(--cerebellum-color); }
        #part-brainstem { fill: var(--brainstem-color); }
        #part-spinal { fill: var(--spinal-color); }
        
        /* ç¥ç¶“å…ƒç¾¤çµ„æ¨£å¼ */
        #part-sensory circle, #part-sensory path { stroke: #555; stroke-width: 2; }
        #part-sensory circle { fill: var(--sensory-color); }
        #part-sensory path { fill: none; stroke: var(--sensory-color); stroke-width: 5; stroke-dasharray: 5,2; }

        #part-motor rect, #part-motor path { stroke: #555; stroke-width: 2; }
        #part-motor rect { fill: var(--motor-color); }
        #part-motor path { fill: none; stroke: var(--motor-color); stroke-width: 5; stroke-dasharray: 5,2; }

        /* é»æ“Šå¾Œçš„ç‹€æ…‹é¡è‰² */
        .brain-part.correct-highlight, 
        .brain-part.correct-highlight circle, 
        .brain-part.correct-highlight rect,
        .brain-part.correct-highlight path { 
            fill: #27ae60 !important; 
            stroke: #27ae60 !important; 
        }
        
        .brain-part.wrong-highlight,
        .brain-part.wrong-highlight circle,
        .brain-part.wrong-highlight rect,
        .brain-part.wrong-highlight path { 
            fill: #e74c3c !important; 
            stroke: #c0392b !important; 
        }

        /* å›é¥‹å€å¡Š */
        .feedback-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.5s;
        }
        .feedback-area.correct { background-color: #d5f5e3; color: #145a32; border: 1px solid #27ae60; }
        .feedback-area.wrong { background-color: #fadbd8; color: #7b241c; border: 1px solid #c0392b; }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .diagnosis-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            display: none;
            transition: transform 0.2s;
            flex: 1;
        }
        .diagnosis-btn:hover { transform: scale(1.05); background-color: #16a085; }

        /* AI åŠŸèƒ½æŒ‰éˆ• */
        .ai-btn {
            background-color: white;
            color: var(--ai-color);
            border: 2px solid var(--ai-color);
            padding: 8px 15px;
            border-radius: 50px;
            font-size: 0.95rem;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        .ai-btn:hover { background-color: var(--ai-color); color: white; }
        .ai-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .ai-hint-box {
            background-color: #f3e5f5;
            border: 1px dashed var(--ai-color);
            color: #4a235a;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
            display: none;
            animation: fadeIn 0.5s;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.5s;
        }

        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid currentColor;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @media (max-width: 768px) {
            .main-container { flex-direction: column-reverse; }
            .chart-panel { border-right: none; border-top: 1px solid #eee; padding: 20px; }
            .diagram-panel { min-height: 400px; }
            .symptom-box { font-size: 1.2rem; }
        }

        .final-btn {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 1.3rem;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .final-btn:hover { background-color: #2c3e50; transform: translateY(-3px); }

    </style>
</head>
<body>

    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

    <header>
        <h1>ğŸ‘¨â€âš•ï¸ ç¥ç¶“ç§‘é†«ç”Ÿè¨ºæ–·å®¤</h1>
        <div class="subtitle">è«‹æ ¹æ“šç—…æ‚£ç—‡ç‹€ï¼Œé»æ“Šä»£è™Ÿä½ç½®é€²è¡Œè¨ºæ–·</div>
    </header>

    <div class="main-container" id="game-panel">
        <div class="chart-panel">
            <div class="case-number">
                <span id="case-num">CASE 01</span>
                <span class="ai-badge" id="ai-badge">âœ¨ AI ç”Ÿæˆç—…æ­·</span>
            </div>
            
            <div class="symptom-box" id="symptom-text">
                ç—…æ‚£é€é†«æ™‚é‚„æœ‰å‘¼å¸å¿ƒè·³ï¼Œä½†é€™å¹¾å¤©è§€å¯Ÿä¸‹ä¾†ï¼Œä»–å®Œå…¨æ²’æœ‰æ„è­˜ï¼Œç„¡æ³•æ€è€ƒï¼Œå°å¤–ç•Œå‘¼å–šä¹Ÿæ²’æœ‰åæ‡‰ï¼ˆé¡ä¼¼æ¤ç‰©äººç‹€æ…‹ï¼‰ã€‚
            </div>
            
            <div class="instruction">
                è«‹é»æ“Šå³åœ–ï¼šé€™ä½ç—…æ‚£å—ææœ€åš´é‡çš„æ§‹é€ ä»£è™Ÿæ˜¯ï¼Ÿ
            </div>

            <div class="btn-group" id="tools-area">
                <button class="ai-btn" id="hint-btn" onclick="getAIHint()">
                    <span>âœ¨ å‘¼å« AI é¡§å•</span>
                </button>
            </div>
            
            <div class="ai-hint-box" id="ai-hint-display"></div>
            <div class="feedback-area" id="feedback-box"></div>
            
            <div class="btn-group">
                <button class="diagnosis-btn" id="next-btn" onclick="nextCase()">ä¸‹ä¸€ä½ç—…æ‚£ âœ</button>
                <button class="diagnosis-btn" id="ai-case-btn" onclick="generateAICase()" style="background-color: var(--ai-color); display:none;">âœ¨ ç”Ÿæˆ AI æ–°ç—…ä¾‹</button>
            </div>
        </div>

        <div class="diagram-panel">
            <svg viewBox="0 0 400 500" id="brain-svg">
                <!-- è¼ªå»“é™°å½± -->
                <path d="M100,150 Q100,50 200,50 Q300,50 300,150 Q300,250 200,250 L200,380" stroke="none" fill="#f0f0f0" opacity="0.5"/>

                <!-- ä¸ï¼šè„Šé«“ -->
                <path id="part-spinal" class="brain-part" 
                      d="M180,220 L180,420 L220,420 L220,220 Z" 
                      onclick="checkAnswer('spinal')"/>
                
                <!-- ä¸™ï¼šè…¦å¹¹ -->
                <path id="part-brainstem" class="brain-part" 
                      d="M170,180 L170,230 L230,230 L230,180 Q210,170 190,170 Q180,170 170,180 Z" 
                      onclick="checkAnswer('brainstem')"/>
                
                <!-- ä¹™ï¼šå°è…¦ -->
                <path id="part-cerebellum" class="brain-part" 
                      d="M220,180 Q290,180 300,220 Q290,260 230,260 Q200,260 220,180 Z" 
                      onclick="checkAnswer('cerebellum')"/>
                
                <!-- ç”²ï¼šå¤§è…¦ -->
                <path id="part-cerebrum" class="brain-part" 
                      d="M130,160 Q130,50 230,50 Q310,50 310,150 Q310,180 250,180 L230,180 Q170,180 130,160" 
                      onclick="checkAnswer('cerebrum')"/>

                <!-- æˆŠï¼šæ„Ÿè¦ºç¥ç¶“å…ƒ -->
                <g id="part-sensory" class="brain-part" onclick="checkAnswer('sensory')">
                    <circle cx="50" cy="350" r="15" />
                    <path d="M65,350 Q120,350 180,360" />
                    <circle cx="160" cy="358" r="6" />
                </g>

                <!-- å·±ï¼šé‹å‹•ç¥ç¶“å…ƒ -->
                <g id="part-motor" class="brain-part" onclick="checkAnswer('motor')">
                    <path d="M220,380 Q280,380 350,380" />
                    <rect x="350" y="365" width="30" height="30" rx="5" />
                </g>

                <!-- ä»£è™Ÿæ¨™ç±¤ (ç”²ä¹™ä¸™ä¸) -->
                <text x="100" y="100" font-size="24" font-weight="bold" fill="#333" pointer-events="none">ç”²</text>
                <line x1="125" y1="95" x2="160" y2="110" stroke="#555" stroke-width="2"/>
                <text x="320" y="220" font-size="24" font-weight="bold" fill="#333" pointer-events="none">ä¹™</text>
                <line x1="315" y1="215" x2="280" y2="215" stroke="#555" stroke-width="2"/>
                <text x="110" y="215" font-size="24" font-weight="bold" fill="#333" pointer-events="none">ä¸™</text>
                <line x1="135" y1="210" x2="175" y2="210" stroke="#555" stroke-width="2"/>
                <text x="240" y="300" font-size="24" font-weight="bold" fill="#333" pointer-events="none">ä¸</text>
                <line x1="235" y1="295" x2="200" y2="295" stroke="#555" stroke-width="2"/>
                
                <text x="100" y="330" font-size="24" font-weight="bold" fill="#333" pointer-events="none">æˆŠ</text>
                <line x1="120" y1="335" x2="140" y2="350" stroke="#555" stroke-width="2"/>
                <text x="280" y="350" font-size="24" font-weight="bold" fill="#333" pointer-events="none">å·±</text>
                <line x1="275" y1="355" x2="250" y2="380" stroke="#555" stroke-width="2"/>

                <!-- å—å™¨/å‹•å™¨ æ¨™ç±¤ (ç„¡æ¡†æ¨£å¼) -->
                <text x="20" y="390" font-size="24" font-weight="bold" fill="#333" pointer-events="none">å—å™¨</text>
                <line x1="45" y1="380" x2="50" y2="365" stroke="#555" stroke-width="2"/>

                <text x="340" y="420" font-size="24" font-weight="bold" fill="#333" pointer-events="none">å‹•å™¨</text>
                <line x1="365" y1="400" x2="365" y2="395" stroke="#555" stroke-width="2"/>

            </svg>
        </div>
    </div>

    <a href="3-0.html" class="final-btn" id="final-link">ğŸ‰ è¨ºæ–·å®Œæˆï¼å‰å¾€å–®å…ƒ3ï¼šæ„è­˜èˆ‡åå°„</a>

    <script>
        const apiKey = ""; 

        const fixedCases = [
            { id: 1, text: "ç—…æ‚£é€é†«æ™‚é‚„æœ‰å‘¼å¸å¿ƒè·³ï¼Œä½†é€™å¹¾å¤©è§€å¯Ÿä¸‹ä¾†ï¼Œä»–å®Œå…¨æ²’æœ‰æ„è­˜ï¼Œç„¡æ³•æ€è€ƒï¼Œå°å¤–ç•Œå‘¼å–šä¹Ÿæ²’æœ‰åæ‡‰ï¼ˆé¡ä¼¼æ¤ç‰©äººç‹€æ…‹ï¼‰ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ç”²)<br>ç”²æ˜¯å¤§è…¦ï¼Œå—ææœƒå°è‡´æ„è­˜å–ªå¤±ã€ç„¡æ³•æ€è€ƒï¼Œè®Šæˆæ¤ç‰©äººã€‚ä½†ä»–é‚„æœ‰å‘¼å¸å¿ƒè·³ï¼Œè¡¨ç¤ºè…¦å¹¹åŠŸèƒ½æ­£å¸¸ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>é€™å€‹éƒ¨ä½å¦‚æœå—æï¼Œé€šå¸¸æœƒå½±éŸ¿å¹³è¡¡æˆ–ç”Ÿå‘½å¾µè±¡ï¼Œä½†ç—…æ‚£çš„å•é¡Œæ˜¯ã€Œæ²’æœ‰æ„è­˜ã€ã€‚" },
            { id: 2, text: "ç—…æ‚£ä¸»è¨´æœ€è¿‘èµ°è·¯ç„¡æ³•èµ°ç›´ç·šï¼Œä¸€ç›´æ–æ–æ™ƒæ™ƒï¼Œæ‹¿æ¯å­æ™‚æ‰‹ä¹ŸæœƒæŠ–å€‹ä¸åœï¼Œç„¡æ³•æº–ç¢ºæŠ“æ¡ã€‚", answer: "cerebellum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ä¹™)<br>ä¹™æ˜¯å°è…¦ï¼Œè² è²¬å”èª¿å…¨èº«è‚Œè‚‰èˆ‡ç¶­æŒå¹³è¡¡ã€‚èµ°è·¯æ–æ™ƒã€å‹•ä½œä¸æº–ç¢ºæ˜¯å…¸å‹çš„å°è…¦å—æç—‡ç‹€ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>ç—…æ‚£æ„è­˜æ¸…æ¥šï¼Œå‘¼å¸ä¹Ÿæ­£å¸¸ï¼Œä¸»è¦æ˜¯ã€Œå‹•ä½œå”èª¿ã€å‡ºäº†å•é¡Œã€‚" },
            { id: 3, text: "é€™æ˜¯ä¸€èµ·åš´é‡è»Šç¦ï¼Œç—…æ‚£åˆ°é™¢å‰å·²ç¶“åœæ­¢å‘¼å¸èˆ‡å¿ƒè·³ï¼Œç¶“éæ€¥æ•‘ä»å®£å‘Šä¸æ²»ã€‚", answer: "brainstem", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ä¸™)<br>ä¸™æ˜¯è…¦å¹¹ï¼Œè¢«ç¨±ç‚ºã€Œç”Ÿå‘½ä¸­æ¨ã€ï¼Œè² è²¬æ§åˆ¶å‘¼å¸èˆ‡å¿ƒæã€‚ä¸€æ—¦å—æï¼Œç”Ÿå‘½æœƒç«‹å³å—åˆ°å¨è„…ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>ç—…æ‚£æ˜¯ç›´æ¥å–ªå¤±ç”Ÿå‘½å¾µè±¡ï¼ˆå‘¼å¸å¿ƒè·³ï¼‰ï¼Œé€™æ˜¯æ›´æ·±å±¤çš„ä¸­æ¨æ§åˆ¶çš„ã€‚" },
            { id: 4, text: "ç—…æ‚£å¾é«˜è™•è·Œè½å¾Œï¼Œè…°éƒ¨ä»¥ä¸‹å®Œå…¨å¤±å»çŸ¥è¦ºï¼ˆä¸‹åŠèº«ç™±ç˜“ï¼‰ï¼Œä¹Ÿç„¡æ³•æ§åˆ¶æ’ä¾¿ï¼Œä½†æ‰‹éƒ¨æ´»å‹•æ­£å¸¸ï¼Œæ„è­˜ä¹Ÿæ¸…é†’ã€‚", answer: "spinal", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ä¸)<br>ä¸æ˜¯è„Šé«“ï¼Œæ˜¯è…¦èˆ‡è»€å¹¹çš„é€šé“ã€‚è„Šé«“å—æï¼Œæœƒå°è‡´è¨Šè™Ÿç„¡æ³•å‚³åˆ°ä¸‹åŠèº«ï¼Œé€ æˆç™±ç˜“ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>ç—…æ‚£çš„é ­è…¦éƒ½å¾ˆæ¸…æ¥šï¼Œå•é¡Œæ˜¯å‡ºåœ¨ã€Œè¨Šè™Ÿå‚³ä¸åˆ°ä¸‹åŠèº«ã€ã€‚" },
            { id: 5, text: "ç—…æ‚£ä¸­é¢¨å¾Œï¼Œé›–ç„¶è½å¾—æ‡‚åˆ¥äººåœ¨èªªä»€éº¼ï¼Œä½†è‡ªå·±å»ç„¡æ³•èªªå‡ºæµæš¢çš„å¥å­ï¼ˆå¤±èªç—‡ï¼‰ï¼Œæˆ–æ˜¯è¨˜ä¸ä½å®¶äººçš„åå­—ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ç”²)<br>èªè¨€ã€è¨˜æ†¶ã€èªªè©±èƒ½åŠ›éƒ½æ˜¯ç”±å¤§è…¦çš®å±¤æ§åˆ¶çš„é«˜ç´šåŠŸèƒ½ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>èªè¨€èˆ‡è¨˜æ†¶æ˜¯å¾ˆé«˜éšçš„åŠŸèƒ½ï¼Œé€šå¸¸ä¸æ­¸å°è…¦æˆ–è…¦å¹¹ç®¡è½„ã€‚" },
            { id: 6, text: "ç—…æ‚£çœ¼ç›é‡åˆ°å¼·å…‰ç³å­”æœƒç¸®å°ï¼ˆåå°„æ­£å¸¸ï¼‰ï¼Œä½†æ˜¯ä½ å«ä»–ç®—ã€Œ3+2=ï¼Ÿã€ä»–å»ç®—ä¸å‡ºä¾†ã€‚", answer: "cerebrum", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(ç”²)<br>ç®—è¡“æ€è€ƒæ˜¯å¤§è…¦è² è²¬ã€‚é›–ç„¶ç³å­”åå°„ï¼ˆè…¦å¹¹æ§åˆ¶ï¼‰æ­£å¸¸ï¼Œä½†ç„¡æ³•é‹ç®—ä»£è¡¨å¤§è…¦å—æã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>é€™é¡Œæœ‰é™·é˜±ï¼ç³å­”åå°„æ­£å¸¸ä»£è¡¨è…¦å¹¹(ä¸™)æ²’äº‹ï¼Œä½†ã€Œç®—æ•¸å­¸ã€æ˜¯èª°è² è²¬çš„å‘¢ï¼Ÿ" },
            { id: 7, text: "ã€æŒ‘æˆ°é¡Œã€‘ç—…æ‚£æ„Ÿè¦ºèº«é«”é€æ¼¸ç„¡åŠ›ï¼Œæ‰‹è…³è‚Œè‚‰é–‹å§‹èç¸®ï¼Œèµ°è·¯å®¹æ˜“è·Œå€’ï¼Œç”šè‡³é€£æ‹¿ç­·å­éƒ½æœ‰å›°é›£ã€‚ä½†æ˜¯ä»–çš„æ„Ÿè¦ºæ­£å¸¸ï¼ˆè¢«ææœƒç—›ï¼‰ï¼Œæ„è­˜ä¹Ÿéå¸¸æ¸…æ¥šï¼Œé‚„èƒ½è·Ÿé†«ç”Ÿç®—æ•¸å­¸ã€‚", answer: "motor", correctMsg: "âœ… è¨ºæ–·æ­£ç¢ºï¼(å·±)<br>é€™æ˜¯å…¸å‹çš„é‹å‹•ç¥ç¶“å…ƒç–¾ç—…ï¼ˆå¦‚æ¼¸å‡äººï¼‰ã€‚é‹å‹•ç¥ç¶“å…ƒ(å·±)å—æå°è‡´è‚Œè‚‰ç„¡æ³•æ¥æ”¶æŒ‡ä»¤è€Œèç¸®ï¼Œä½†æ„Ÿè¦º(æˆŠ)å’Œæ€è€ƒ(ç”²)åŠŸèƒ½é€šå¸¸ä¸å—å½±éŸ¿ã€‚", wrongMsg: "âŒ è¨ºæ–·éŒ¯èª¤ã€‚<br>ç—…æ‚£ã€Œæ„Ÿè¦ºæ­£å¸¸ã€ä»£è¡¨å—å™¨èˆ‡æ„Ÿè¦ºç¥ç¶“å…ƒ(æˆŠ)æ²’å£ï¼Œã€Œæ„è­˜æ¸…æ¥šã€ä»£è¡¨å¤§è…¦(ç”²)æ²’å£ã€‚å•é¡Œæ˜¯å‡ºåœ¨è‚Œè‚‰æ”¶ä¸åˆ°å‘½ä»¤ï¼" }
        ];

        let currentIdx = 0;
        let isSolved = false;
        let currentCase = null;

        function init() {
            renderCase(fixedCases[0]);
        }

        function renderCase(caseData) {
            currentCase = caseData;
            isSolved = false;
            
            const caseTitle = caseData.isAI ? `AI CASE` : `CASE 0${currentIdx + 1}`;
            document.getElementById('case-num').innerText = caseTitle;
            document.getElementById('symptom-text').innerText = caseData.text;
            document.getElementById('ai-badge').style.display = caseData.isAI ? 'inline-block' : 'none';

            document.getElementById('feedback-box').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('ai-case-btn').style.display = 'none';
            document.getElementById('ai-hint-display').style.display = 'none';
            document.getElementById('hint-btn').disabled = false;
            document.getElementById('hint-btn').innerHTML = '<span>âœ¨ å‘¼å« AI é¡§å•</span>';
            
            document.querySelectorAll('.brain-part').forEach(el => {
                el.classList.remove('correct-highlight', 'wrong-highlight');
                el.style.pointerEvents = 'auto';
            });

            if (!caseData.isAI) {
                const percent = (currentIdx / fixedCases.length) * 100;
                document.getElementById('progress-fill').style.width = `${percent}%`;
            } else {
                document.getElementById('progress-fill').style.width = '100%';
            }
        }

        function checkAnswer(partId) {
            if (isSolved) return;

            const feedbackBox = document.getElementById('feedback-box');
            let clickedPart = document.getElementById('part-' + partId);
            
            feedbackBox.style.display = 'block';

            if (partId === currentCase.answer) {
                isSolved = true;
                feedbackBox.innerHTML = currentCase.correctMsg;
                feedbackBox.className = "feedback-area correct";
                clickedPart.classList.add('correct-highlight');
                
                document.querySelectorAll('.brain-part').forEach(el => el.style.pointerEvents = 'none');

                if (!currentCase.isAI && currentIdx < fixedCases.length - 1) {
                    document.getElementById('next-btn').style.display = 'block';
                } else {
                    document.getElementById('ai-case-btn').style.display = 'block';
                    document.getElementById('final-link').style.display = 'inline-block';
                    document.getElementById('progress-fill').style.width = '100%';
                }

            } else {
                feedbackBox.innerHTML = currentCase.wrongMsg || "âŒ è¨ºæ–·éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
                feedbackBox.className = "feedback-area wrong";
                clickedPart.classList.add('wrong-highlight');
                setTimeout(() => {
                    clickedPart.classList.remove('wrong-highlight');
                }, 500);
            }
        }

        function nextCase() {
            if (currentIdx < fixedCases.length - 1) {
                currentIdx++;
                renderCase(fixedCases[currentIdx]);
            }
        }

        async function getAIHint() {
            const btn = document.getElementById('hint-btn');
            const hintBox = document.getElementById('ai-hint-display');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span> AI æ€è€ƒä¸­...';

            const prompt = `
                ä½ æ˜¯ä¸€ä½åœ‹ä¸­ç”Ÿç‰©è€å¸«ã€‚å­¸ç”Ÿæ­£åœ¨é€²è¡Œç¥ç¶“ç³»çµ±çš„è¨ºæ–·éŠæˆ²ã€‚
                ç›®å‰çš„ç—…ä¾‹ç—‡ç‹€æ˜¯ï¼šã€Œ${currentCase.text}ã€ã€‚
                è«‹çµ¦å­¸ç”Ÿä¸€å€‹ç°¡çŸ­çš„æç¤º(Hint)ï¼Œå¼•å°ä»–æ€è€ƒæ˜¯å“ªå€‹éƒ¨ä½å—æï¼Œä½†ã€Œçµ•å°ä¸è¦ã€ç›´æ¥èªªå‡ºç­”æ¡ˆåç¨±(å¦‚å¤§è…¦ã€å°è…¦ã€è„Šé«“ç­‰)ã€‚
                è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œèªæ°£é¼“å‹µä¸”ç¥ç§˜ï¼Œ50å­—ä»¥å…§ã€‚
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                
                const data = await response.json();
                const hintText = data.candidates[0].content.parts[0].text;
                
                hintBox.style.display = 'block';
                hintBox.innerHTML = `<strong>ğŸ’¡ AI é¡§å•æç¤ºï¼š</strong><br>${hintText}`;
                
            } catch (error) {
                console.error(error);
                hintBox.style.display = 'block';
                hintBox.innerText = "âš ï¸ AI é€£ç·šå¿™ç¢Œä¸­ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
            } finally {
                btn.innerHTML = '<span>âœ¨ å‘¼å« AI é¡§å•</span>';
            }
        }

        async function generateAICase() {
            const btn = document.getElementById('ai-case-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span> AI ç”Ÿæˆä¸­...';

            const prompt = `
                è«‹ç”Ÿæˆä¸€å€‹åœ‹ä¸­ç”Ÿç‰©ç¨‹åº¦çš„ã€Œç¥ç¶“ç³»çµ±å—æç—…ä¾‹ã€ã€‚
                ç›®æ¨™éƒ¨ä½å¿…é ˆæ˜¯ä»¥ä¸‹å…¶ä¸­ä¹‹ä¸€ï¼š
                - cerebrum (å¤§è…¦): æ„è­˜, è¨˜æ†¶, æ„Ÿè¦º, é‹å‹•, èªè¨€
                - cerebellum (å°è…¦): å¹³è¡¡, å”èª¿
                - brainstem (è…¦å¹¹): å‘¼å¸, å¿ƒè·³, ç”Ÿå‘½ä¸­æ¨
                - spinal (è„Šé«“): è»€å¹¹å››è‚¢å‚³å°, åå°„
                - sensory (æ„Ÿè¦ºç¥ç¶“å…ƒ): æ„Ÿè¦ºå‚³å…¥
                - motor (é‹å‹•ç¥ç¶“å…ƒ): è‚Œè‚‰é‹å‹•å‚³å‡º
                
                è«‹å›å‚³ä¸€å€‹ç´” JSON ç‰©ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
                {
                    "text": "æè¿°ç—…äººçš„ç—‡ç‹€(ç¹é«”ä¸­æ–‡)...",
                    "answer": "å°æ‡‰çš„éƒ¨ä½ä»£ç¢¼ (å¦‚ cerebrum)",
                    "correctMsg": "âœ… è¨ºæ–·æ­£ç¢ºï¼(èªªæ˜åŸå› ...)",
                    "wrongMsg": "âŒ è¨ºæ–·éŒ¯èª¤ã€‚(æç¤º...)"
                }
                å…§å®¹è¦ç”Ÿå‹•æœ‰è¶£ï¼Œç¬¦åˆé†«å­¸é‚è¼¯ä½†ä¸è¦å¤ªæ·±å¥§ã€‚
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const data = await response.json();
                const aiCaseData = JSON.parse(data.candidates[0].content.parts[0].text);
                
                aiCaseData.isAI = true;
                
                renderCase(aiCaseData);

            } catch (error) {
                console.error(error);
                alert("AI ç”Ÿæˆå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚");
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'âœ¨ ç”Ÿæˆ AI æ–°ç—…ä¾‹';
            }
        }

        init();

    </script>
</body>
</html>
